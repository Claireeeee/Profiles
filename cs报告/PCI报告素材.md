





北桥芯片　　　

主要负责CPU与内存之间的数据交换，并控制AGP、PCI数据在其内部的传输，是主板性能的主要决定因素。



FSB 　　FSB=Front Side BUS前端总线　　FSB只指CPU与北桥芯片之间的数据传输总线，又称前端总线。　　对于P4来说，FSB频率=CPU外频*4。 　　这个参数指的就是前端总线的频率，它是处理器与主板交换数据的通道 北桥芯片负责联系内存、显卡等数据吞吐量最大的部件，并和南桥芯片连接。CPU就是通过前端总线（FSB）连接到北桥芯片，进而通过北桥芯片和内存、显卡交换数据。前端总线是CPU和外界交换数据的最主要通道，因此前端总线的数据传输能力对计算机整体性能作用很大，如果没足够快的前端总线，再强的CPU也不能明显提高计算机整体速度。数据传输最大带宽取决于所有同时传输的数据的宽度和传输频率，即数据带宽＝（总线频率×数据位宽）÷8。目前PC机上所能达到的前端总线频率有266MHz、333MHz、400MHz、533MHz、800MHz几种，前端总线频率越大，代表着CPU与北桥芯片之间的数据传输能力越大，更能充分发挥出CPU的功能。





PCI 一种由英特尔（Intel）公司1991年推出的用于定义局部总线的标准。此标准允许在计算机内安装多达10个遵从PCI标准的扩展卡。最早提出的PCI总线工作在33MHz频率之下，传输带宽达到133MB/s(33MHz * 32bit/s)，基本上满足了当时处理器的发展需要。随着对更高性能的要求，1993年又提出了64bit的PCI总线，后来又提出把PCI 总线的频率提升到66MHz。 

 

PCIE 　　PCI-Express是最新的总线和接口标准，它原来的名称为“3GIO”，是由英特尔提出的，很明显英特尔的意思是它代表着下一代I/O接口标准。交由PCI-SIG（PCI特殊兴趣组织）认证发布后才改名为“PCI-Express”，简称“PCI-E”。这个新标准将全面取代现行的PCI和AGP，最终实现总线标准的统一。它的主要优势就是数据传输速率高，目前最高的16X 2.0版本可达到10GB/s，而且还有相当大的发展潜力。PCI Express也有多种规格，从PCI Express 1X到PCI Express 16X，能满足现在和将来一定时间内出现的低速设备和高速设备的需求。现在主流主板都能能支持PCI Express 1.0 16X，也有部分较高端的主板支持PCI Express 2.0 16X，例如INTEL的P45、X48和AMD的770、780G、790X和790GX以及Nvidia GF8200等。当前PCI Express基本全面取代了AGP，就象当初PCI取代ISA一样，这个过程已经过度完毕了，虽然还有一些老用户在用AGP接口的显卡，但是市面上AGP显卡全面停卖，包括AGP插槽的主板也不见了踪影。 AGP 关于AGP，是当前被已经淘汰的图形系统接口















QPI总线标准：

QPI(QuickPath Interconnect，快速通道互联)是Intel用来取代FSB(Front Side Bus，前端总线)的新一代高速总线，CPU与CPU之间或者CPU与北桥芯片之间都可以使用QPI相连。在民用级的i7+X58平台，i7处理器与X58北桥芯片之间就通过QPI总线相连。



而通过Intel官方Lynnfield核心（也就是Core i5）示意图来看，Lynnfield处理器与芯片组之间居然没有使用QPI、而是通过DMI总线相连。要知道QPI总线带宽高达25GB/s，而DMI仅有2GB/s。      事实上在iLynnfield处理器内部，除了像Bloomfield那样整合了以往北桥的主要模块——内存控制器外，Intel索性连PCI-E控制器也整合了进去（因此上图显卡直接与CPU相连），这就相当于整颗北桥都被CPU吃掉了，连接CPU与北桥的QPI总线自然也不会幸免。如此一来，CPU将直接与“南桥”相连，他们之间的总线叫做DMI。 

其实DMI(Direct Media Interface)总线大家并不陌生，Intel全系列芯片组的南桥和北桥之间都使用带宽为2GB/s的DMI总线相连，i7的X58与ICH10R南桥之间的总线也是DMI。因此，Lynnfield与Bloomfield相比，在总线方面没有任何缩水，而且Lynnfield的整合程度比i7更高，整个北桥都被整合至CPU内部，显卡不通过北桥直接与CPU相连，理论图形效能会更强！







大体上说：北桥负责与CPU通信，并且连接高速设备（内存/显卡），并且与南桥通信；南桥负责与低速设备（硬盘/USB）通信，时钟/BIOS/系统管理/旧式设备控制，并且与北桥通信。

Intel从第一代Core i7 (i7 9xx)开始，将原属于北桥功能的内存控制器整合到CPU当中，在主流机Core i中(i7 8xx)更将PCI-e控制器（主要负责连接显卡）整合到CPU当中，这时候传统意义上的北桥的所有功能都已经整合到CPU内部了，所以Intel 50系芯片“组”（X58除外，这是搭配i7 9xx用的，还有北桥）已经没有传统意义的北桥了，而南桥依然负责处理低速设备（SATA/USB/PCI等）、时钟等功能。由于只剩下一个芯片了，也没有“芯片组”的说法了，只剩下孤零零的PCH (Platform Controller Hub)。

AMD平台的发展轨迹类似，在K8架构（第一代AMD64处理器）开始就把内存控制器集成到CPU内部，后来先是APU再是桌面的FX系列，陆陆续续把PCI-e控制器也整合到CPU中，也剩下孤零零的FCH (Fusion Controller Hub)……

于是这两家的南桥（PCH/FCH）现在差不多变成了一个PCI-e Hub了……

至于说多出来的空间……如果还是ATX大板的话，现在主板厂商流行在原来布置北桥的地方放个M.2接口（哦这是近两年，前几年还没这接口的时候高端板流行塞一大个散热片显得很帅，低端板就空置了……）。另一种形式是出现了mini-ITX结构的主板，把主板直接缩小了，这在以前南北桥的年代基本是不可想象的。





所谓的桥，就是Bridge，桥接的意思。



以前的老式电脑中，CPU是通过南桥和北桥连接其它设备的。其中北桥连接高速设备和南桥，南桥连接低速设备。



例如：

CPU——北桥——内存

CPU——北桥——显卡

CPU——北桥——南桥——硬盘

CPU——北桥——南桥——网卡

CPU——北桥——南桥——PS/2键鼠

CPU——北桥——南桥——USB设备



Intel从SandyBridge开始，CPU整合内存控制器和PCI-E控制器、DMI通道，相当于是把原来北桥的功能集成在CPU内部了，北桥自然就消失了。南桥换了个称呼叫IO Hub。









自Intel有CPU开始，便一直采用的是称之为“前端总线（Front Side Bus, FSB）”的外部总线。前端总线是由内存和I/O共享的一条通往CPU的通道。新一代的Intel 处理器将内置内存控制器，所以该处理器将提供两个通道：连接CPU和内存的内存总线(memory bus)以及连接CPU和I/O的I/O总线。这个新增的I/O总线称之为快速互联通道（QuickPath Interconnect, QPI）。

顺便一提的是，技术上将QPI和HyperTransport并不能称之为总线而只是点对点连接。总线是指允许多个部件同时连接的一组导线。点对点连接指的是仅仅连接两个部件。尽管技术上称它为总线不太对，为了简便起见和我们还是这么叫吧。





3：QPI LINK

QPI的全称是快速通道互联，其实QPI总线在早期已经用于安腾以及至强平台上，用于取代老旧的FSB。而下放到桌面级则是从第一代Nehalem处理器上。一直到今天我们用的8700K，全部是基于QPI总线来进行通信。和HT LINK一样，QPI总线一样是点对点通信，用于CPU，北桥，南桥之间的点对点连接。而它的速度也已经远远超越了FSB总线，以末代的1600MHz的FSB为例，它的传输速度为12.8GB/s，而初版的QPI总线就达到了25.6GB/s，相比上一代直接翻了一倍，而到了SNB上，内置CPU内存控制器的总线依旧是由QPI总线衍生而来，只不过由于是环形总线，不仅大大提升了速度，也保持了缓存的一致性。而和南桥之间的通信一直用的都是DMI总线。











著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

首先把这个问题仅限于x86平台。其他cpu架构不见得是这么分。
并且仅限于2000-2010年范围。这些概念也许只有DIYer圈知道。好容易遇到个专业相关的，让我发挥下吧。我不是DIYer，说错勿笑。
今2年intel的动作频频，把南北桥都要合并了。你的这个问题，再过几年也许就没意义了。

先挑软柿子捏
**系统总线**
特指 PCI/PCIe 总线。这是Intel主导发展的总线标准。
什么？还有EISA、VESA总线？请把他们遗忘在20世纪吧。胜者为王。
人的大脑和其他的器官、四肢，大部分靠脊髓相连。PCI/PCIe 总线 ，就相当于x86架构机器的脊髓。
其他内部总线、外部总线，都是挂在系统总线上的。USB、SATA、1394，统统是 PCI/PCIe 总线的下级。
主要因为PCI/PCIe 总线 带宽高；拥有硬件探测能力；改进的标准能热插拔。
顺带提一下，因为PCI/PCIe 总线的硬件探测能力，加上微软定义的几套PC制造标准，我们才能一张xp盘装无数的x86机器。

**外部总线**
诸如USB SATA IDE 1394 串口 以太网，这些暴露给普通用户插的，就是外部总线。
前面提到过，他们都是PCI/PCIe 总线 的下级。例如在PCI/PCIe 总线上，USB控制器是pci设备。在USB总线上，USB控制器又是头头，U盘是设备。 U盘里的数据想去cpu，得经由 usb总线 -->pci总线-->前端总线-->CPU
**内部总线**
外部总线上，还有一些零碎的低速小芯片。这个一般用户接触不到，是给制造商的开发人员用的。例如网卡需要一片eeprom来存唯一的MAC地址。很多pci卡上都能找到这些小flash。某些pci卡还有温度传感器。网卡的MAC和PHY之间也要有总线来读取链接速度、是否link等信息。控制这些小芯片使用诸如I2C SPI总线，即所谓的内部总线。

**前端总线**
就是CPU和北桥、内存的连接总线了。北桥是PCI/PCIe 总线 的发源地。
但是由于技术的进步，FSB已经被取代（或逐步取代），AMD很早就开始采用自己的HyperTransport（后续版本更改为HyperTransport Link简称HT link）代替了FSB来提高cpu与内存等芯片的数据传输速度，而intel亦采用QuickPathInterconnect（QPI）技术。但是总体上讲，这两种技术都是FSB的进化。

外频

看名字就知道，这是频率。频率是看不见的，前端总线是看得见的。

其实外频，不就是给cpu的输入时钟嘛。比如给cpu一个66Mhz的时钟输入，cpu通过把这个输入通过PLL翻倍，成为我们熟悉的几个GHz的频率。

早期外频和前端总线的频率一致，相当于外频x1，但是后来前端总线的频率也会在外频上翻倍，但应该低于cpu频率。



















当世界失去[FSB](https://baike.baidu.com/item/FSB/427104)我们还有QPI

Intel自身也清醒的认识到，要想在通过单纯提高处理器的外频和[FSB](https://baike.baidu.com/item/FSB/427104)，也难以像以前那样带来更好的性能提升。采用全新的Nehalem架构的intel下一代[CPU](https://baike.baidu.com/item/CPU/120556)让我们看到了英特尔变革的决心。目前已经正式发布，基于该架构的代号为Boomfield第一款处理器，我们可以看见很多很多技术的细节——该处理器拥有全新的规格和性能，采用全新的LGA 1366接口，45nm制程，集成三通道[DDR3](https://baike.baidu.com/item/DDR3/9505741)内存控制器（支持DDR3 800/1066/1333/1600内存规格），使用新总线QPI与处理器进行连接，支持SMT（Simultaneous Muti-hreading,单颗处理器就可以支持8线程并行技术）多线程技术，支持SSE4.2指令集（增加了7条新的SSE4指令），是intel第一款[原生四核处理器](https://baike.baidu.com/item/原生四核处理器)……

当然，在其拥有的众多技术中，最引人注目的应该还是QPI（原先宣传的CSI总线）总线技术，他是全新的Nahalem架构之所以能在架构、功能和性能上取得大突破的关键性技术。



编辑

QPI(Quick Path Interconnect)——"快速通道互联"，取代前端总线(FSB)的一种点到点连接技术，20位宽的QPI连接其带宽可达惊人的每秒25.6GB，远非FSB可比。QPI最初能够发放异彩的是支持多个处理器的服务器平台，QPI可以用于多处理器之间的互联。

\1. QPI使通信更加方便

QPI是在处理器中集成内存控制器的体系架构，主要用于处理器之间和系统组件之间的互联通信（诸如I/O）。他抛弃了沿用多年的的FSB，CPU可直接通过内存控制器访问内存资源，而不是以前繁杂的“前端总线——北桥——内存控制器”模式。并且，与AMD在主流的[多核处理器](https://baike.baidu.com/item/多核处理器)上采用的4HT3（4根传输线路，两根用于数据发送，两个用于数据接收）连接方式不同，英特尔采用了4+1 QPI互联方式（4针对处理器，1针对I/O设计），这样多处理器的每个处理器都能直接与物理内存相连，每个处理器之间也能彼此互联来充分利用不同的内存，可以让多处理器的等待时间变短（访问延迟可以下降50%以上），只用一个内存插槽就能实现与四路AMD皓龙处理器（AMD在服务器领域的处理器，与intel至强同等产品定位）同等带宽。

\2. QPI、处理器间峰值带宽可达96GB/s

在intel高端的安腾处理器系统中，QPI高速互联方式使得CPU与CPU之间的峰值带宽可达96GB/s，峰值内存带宽可达34GB/s。这主要在于QPI采用了与PCI-E类似的点对点设计，包括一对线路，分别负责数据发送和接收，每一条通路可传送20bit数据。这就意味着即便是最早的QPI标准，其传输速度也能达到6.4GT/s——总计带宽可达到25.6GB/s(为FSB 1600MHz的12.8GB/S的两倍)。这样的带宽已可媲美AMD目前的总线解决方案，能满足未来CPU与CPU、CPU与芯片的数据传输要求。

\3. 多核间互传资料不用经过芯片组

QPI总线可实现多核处理器内部的直接互联，而无须像以前那样还要再经过FSB进行连接。例如，针对服务器的Nehalem架构的处理器拥有至少4组QPI传输，可至少组成包括4颗处理器的4路高端服务器系统（也就是16颗运算内核至少32线程并行运作）。而且在多处理器作业下，每颗处理器可以互相传送资料，并不需要经过芯片组，从而大幅提升整体系统性能。随着未来Nehalem架构的处理器集成内存控制器、PCI-E 2.0图形接口乃至图形核心的出现，QPI架构的优势见进一步发挥出来。

\4. QPI互联架构本身具有升级性

QPI采用串联方式作为讯号的传送，采用了LVDS（低电压差分信号技术，主要用于高速数字信号互联，使信号能以几百Mbps以上的速率传输）信号技术，可保证在高频率下仍能保持稳定性。QPI拥有更低的延迟及更好的架构，将包括集成的存储器控制器以及系统组件间的通信链路。

\5. QPI总线架构具备可靠性和性能

可靠性、实用性和适用性特点为QPI的高可用性提供了保证。比如链接级循环冗余码验证（CRC）。出现时钟密码故障时，时钟能自动改路发送到数据信道。QPI还具备热插拔。深度改良的微架构、集成内存控制器设计以及QPI直接技术，令Nehalem拥有更出色的执行效率，在单线程同频率下，Nehalem拥有更为出色的执行效率，在单线程同频率条件下，Nehalem的运算能力在相同功耗下比现行的Penryn架构的效能可能提高30%。





做为行业领导性厂商，每次Intel平台的进步都是有人欢喜有人愁。比如，AMD面临着该如何追赶Intel处理器革新速度的问题，如果未来AMD无法跟上英特尔的步伐，其市场份额肯定将变得越来越小。当然，AMD有其过硬的显卡技术支撑，这正是目前Intel所欠缺的。

AMD CPU如真能将其GPU整合，带来的市场影响力也是巨大的。

NVIDIA的处境，Intel的目标是CPU整合GPU，而NVIDIA的目标则是GPU整合CPU，虽然NVIDIA自身对其信心满满，从目前的竞争形势来看，一项是靠显卡技术、芯片组维系的NVIDIA，面对Intel的打压，必须在Intel平台推广SLI，面对Intel和AMD的CPU整合GPU方案，对NVIDIA的低端、中低端显卡市场又非常大的影响。









外围设备连接／局部总线：

## PCI的工作原理，到PCIe

报告内容：背景，场景，特征，基本工作原理，典型部件等









PCI即Peripheral Component Interconnect，中文意思是“外围器件互联”，是由PCISIG (PCI Special Interest Group)推出的一种局部并行总线标准。在现在电子设备中应用非常广泛，下面我详细介绍下PCI总线的工作原理，希望对大家有所帮助。 



## 发展历史

　　PCI总线是由ISA(Industy Standard Architecture)总线发展而来的。

　　ISA并行总线有8位和16位两种模式，时钟频率为8MHz，总线带宽为：8bit*8MHz=64Mbps=8MB/s 或 16bit*8MHz= 128Mbps =16MB/s。在计算机出现初期的386/486时代，ISA总线的带宽已经算是很宽的了，满足CPU的需求可以说是绰绰有余了。

　　1987年，IBM公司推出32位MAC(MicroChannel Architecture)总线，总线带宽达到40MB/s，迫于IBM的压力，Compaq、AST、Epson、HP、Olivetti和NEL等9家公司联合于1988年9月推出EISA(Extended ISA)总线，EISA总线仍然保持ISA总线的8MHz时钟频率，但将总线位宽提高到32位，总线带宽为：32bit*8MHz=256Mbps =  32MB/s，并且与ISA总线完全兼容。    　　

　　随着计算机技术的继续发展，CPU的处理速度越来越快，EISA总线的32MB/s带宽已经满足不了CPU的需求，CPU外围总线带宽已经成为制约计算机处理能力继续提高的瓶颈。1991年下半年，Intel公司首选提出PCI总线的概念，并与IBM、Compaq、AST、HP、DEC等100多家公司成立PCISIG组织，联合推出PCI总线。       

　　PCI总线支持32位和64位两种位宽，时钟频率为33MHz，总线带宽：32bit*33MHz= 1056Mbps =132MB/s 或64bit*33MHz=2112Mbps=264MB/s。   

　　随着PCI总线的发展，PCI总线又发展到PCI-X时代，与PCI总线相比，PCI –X总线的位宽未改变，而是将时钟频率进行了提高。    

　　PCI-X 1.0的时钟频率有66MHZ/100MHz/ 133MHz，总线带宽分别为：264MB/s, 400MB/s和532MB/s(32位)，528MB/s, 800MB/s和1064MB/s(64位)；   

　　PCI-X 2.0的时钟频率有266MHz/533MHz/1066MHz，总线带宽分别为：1064MB/s, 2132MB/s和4264MB/s(32位)，2128MB/s, 4264MB/s和8512MB/s(64位)，PCI-X与PCI总线在硬件结构上完全兼容。   

　　与PCI总线相比，PCI-X除掉在时钟频率高外，还在传输协议上进行了改进，PCI-X采用了“寄存器到寄存器”的新协议，在新协议模式下，发送方发出的数据信号会被预先送入一个专门的寄存器内，并在寄存器中保存一个时钟周期，接收端只要在这个周期内做出响应，取走数据即可。而PCI协议中却没有这个缓冲，数据发出去后，如果对方因某种原因没能及时接收，数据将会被丢弃。   

　　如今，PCI总线已经发展到PCI-Express时代，这是一个串行高速总线，也是由PCISIG推出，分为X1,X2,X4,X8,X12,X16和X32七种模式，X1模式有2对差分线，1对收1对发，X2模式有4对差分线，2对收2对发，其它类推。PCI-E 1.0的速率为2.5Gbps，PCI-E 2.0的速率为5.0Gbps，PCIE 3.0的速率可达8.0Gbps。PCIE正在替代着PCI/PCI-X的角色，相信在不久的将来，PCI/PCI-X总线就如同ISA/EISA总线一样，进入历史的博物馆。



PCI总线结构：

PCI总线是一种树型结构，并且独立于CPU总线，可以和CPU总线并行操作。PCI总线上可以挂接PCI设备和PCI桥片，PCI总线上只允许有一个PCI主设备，其他的均为PCI 从设备，而且读写操作只能在主从设备之间进行，从设备之间的数据交换需要通过主设备中转。

PCI主设备最少需要49根线，从设备最少需要47根线，剩下的线可选。在介绍PCI管脚功能前，先来说明下PCI管脚信号的类型。       

　　in：输入信号；      

　　out：输出信号；      

　　t/s：双向三态信号(Tri-state)，无效时为高组态；      

　　s/t/s：持续三态信号(Sustained Tri-state)，每次由且只由一个单元拥有并驱动的低有效、双向、三态信号。驱动一个s/t/s信号到低的单元在释放该信号浮空之前必须要将它驱动到高电平至少一个周期。这个特点很重要，在后面我们分析PCI信号质量案例的时候会用到；    

　　o/d：漏极开路输出(Open Drain)；     

　　#：此符号代表该信号在低电平时有效。   

 

　　PCI总线引脚图如下所示。  

![WechatIMG332](/Users/caowanlu/Desktop/PCI/WechatIMG332.jpeg)



1).系统引脚         

　　CLK：in，系统时钟，为所有PCI上的传输及总线仲裁提供时序。除RST#外，所有PCI信号都在CLK信号的上升沿采样。        

　　RST#：in，异步复位信号。    



2).地址及数据引脚         

AD[31:0]：t/s，地址数据复用引脚。FRAME#开始变为有效的那个时钟周期内AD[31:0]上传输的是地址。传输数据时，AD[7:0]为最低字节数据。 

C/BE[3:0]#：t/s，总线命令和字节允许复用引脚。在AD[31:0]上传输地址的时候，C[3:0]上传输的是总线命令，AD[31:0]上传输数据的时候，BE[3:0]#用作字节允许，表示哪些通道上的数据是有效的。BE0#对应最低字节

PAR：t/s，AD[31:0]和C/BE[3:0]#上的数据偶效验。PAR与AD[31:0]有相同的时序，但延迟一个时钟，在地址段后一个时钟，PAR稳定并有效；对于数据段，在写传输中，PAR在IRDT#有效一个时钟稳定并有效，而在读传输中，PAR在TRDY#有效后一个时钟周期稳定并有效。一旦PAR有效，它必须保持有效直到当前数据段完成后一个时钟。在地址段和写数据段，主PCI设备驱动PAR，在读数据段，目标从PCI 设备驱动PAR。   



3).接口控制引脚        

　　FRAME#：s/t/s，帧开始信号。由当前总线主设备驱动，以说明一个操作的开始和延续。FRAME#有效，说明总线开始传输，当FRAME#维持有效时，说明总线传输继续进行，当FRAME#无效时，说明传送的最后一个字节正在进行。       

　　IRDY#：s/t/s，启动者准备好信号(Initiator Ready)。说明传输的启动者完成当前数据传输的能力。在读操作中，IRDY#有效说明总线主设备已准备好接收收据。在写操作中，它说明AD[3:0]上已有有效数据。在IRDY#和TRDY#都有效的时钟周期完成数据传输。在IRDY#和TRDY#都有效之前，需要插入等待状态。        

　　TRDY#：s/t/s，目标设备准备就绪(Target Ready)。说明传输的目标设备完成当前的数据传输能力。在写操作中，TRDY#有效说明目标设备已经准备好接收数据。在读操作中，它说明AD[31:0]上已有有效数据。      　　

　　STOP#：s/t/s，停止信号。说明当前的目标设备要求总线主设备停止当前传输。       　　

　　LOCK#：s/t/s，锁定信号。        　　

　　IDSEL：in，初始化设备选择(Initialization Device Select)。在配置空间读写操作中，用作片选。        

　　DEVSEL#：s/t/s，设备选择。当驱动有效时，说明驱动它的设备已将其地址解码为当前操作的目标设备。   



4).仲裁引脚        

　　REQ#：t/s，申请。向仲裁器说明该单元想使用总线。这是一个点对点的信号，每个总线主设备都有自己的REQ#。     

　　GNT#：t/s，允许。仲裁器向申请单元说明其对总线的操作已被允许。这是一个点对点信号，每个总线主设备都有自己的GNT#。   

 



错误反馈，中断，高速缓存支持，64位总线扩充





### 仲裁器工作原理

![WechatIMG333](/Users/caowanlu/Desktop/PCI/WechatIMG333.jpeg)

　假定PCI1,PCI2,PCI3三个设备的优先级相同，上电后，PCI总线仲裁器会将PCI1设备的GNT1信号驱动为低电平(有效)。即PCI1占用PCI总线。如果此时PCI1上没有数据传输，但PCI2上有数据要传输，PCI2设备就会驱动REQ2为低电平来向仲裁器发出PCI总线使用请求。仲裁器在时钟的上升沿采样到REQ2信号，在下一个时钟沿，PCI2将FRAME和IRDY驱动为低电平(FRAME和IRDY是所有PCI设备共用的)，仲裁器在时钟的上升沿采样到这两个信号后，就将GNT2驱动为低电平，应答PCI2的请求，这样，PCI2就拥有了PCI总线的使用权。   

　　这里有一个问题，为什么PCI总线仲裁器不在采样到REQ2信号有效后立即将GNT2置低，将PCI总线的使用权交给PCI2设备，而是要等到PCI2设备的FRAME和IRDY信号有效后才执行呢？   

　　这主要是仲裁器避免某些PCI设备申请总线使用权而实际上不使用，所以要等到FRAME和IRDY信号有效后(表示数据传输准备就绪)才授权使用总线。如果仲裁器在采样到REQ2有效后，一直没有采样到FRAME和IRDY信号有效，仲裁器会不会一直等待下去呢？答案是不会，仲裁器内部有一个定时器，等到定时器超时后，仲裁器就不再等了。   

　　仲裁规则：优先级高设备抢占优先级低设备资源    

　　假设三个PCI设备的优先级顺序为：PCI3>PCI2>PCI1。

　　某个时刻，PCI1正在使用PCI总线传输数据，如果此时PCI2想要使用PCI总线，于是将REQ2驱动为低，向PCI总线仲裁器申请PCI总线的使用权，此时REQ1和REQ2都处于有效状态，虽然PCI2的优先级高于PCI1，但是总线仲裁器不会马上响应PCI2的请求。而是等待PCI1完成一次操作(注意：是一次操作，不是全部)后，PCI1将FRAME和IRDY总线驱动为高(每完成一次操作都需要进行此操作的)。

　　PCI2探测到PCI总线空闲后，将FRAME和IRDY信号驱动为低。总线仲裁器采样到这两个信号有效后，将GNT1驱动为高，同时将GNT2驱动为低，将总线的使用权转交给PCI2。

　　此时，如果PCI1完成了全部传输，会将REQ1驱动为高。    

　　如果PCI1还有数据等待传输，那么它会将REQ1一直保持为低电平，一直进行总线申请。一直等待到PCI2完成所有操作后，还会将PCI总线的使用权释放给PCI1。  





## 读写时序与过程：

　![WechatIMG334](/Users/caowanlu/Desktop/PCI/WechatIMG334.tiff)

写：

如上图所示，在FRAME#有效后的第一个时钟周期内，AD上传输的是要写入目标PCI设备的地址信息，C/BE#上传输的是命令类型(I/O写命令为0011)，DEVSEL#信号有效后，表明目标PCI设备已经被选择到，IRDY#和TRDY#同时有效后，主PCI设备向目标PCI设备中传输要写入的数据，在第5个时钟周期时，IRDY#和TRDY#同时变为无效状态，AD总线上被插入一个等待周期，第6和第7个时钟周期时，IRDY#有效，但是TRDY#无效，传输仍然不能有效进行，总线上被继续插入两个等待周期，第8个时钟周期时，IRDY#和TRDY#都有效，数据传输继续。



读：

读操作同写操作类似，只是在FRAME#有效后的第一个时钟周期内，C/BE#上传输的是读操作命令而已(I/O读操作命令为0010)。  



PCI标准有什么特点吗？

**1. 它是个并行总线**。在一个时钟周期内32个bit（后扩展到64）同时被传输

